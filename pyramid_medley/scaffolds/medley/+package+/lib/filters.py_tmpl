import json
import jinja2


@jinja2.contextfilter
def jsonify(context, value):
    if hasattr(value, '__json__'):
        value = value.__json__(context['request'])
    return jinja2.Markup(json.dumps(value))
